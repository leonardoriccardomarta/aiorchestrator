<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot Widget</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: transparent;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="ai-orchestrator-widget-container" style="
      position: fixed !important;
      bottom: 1.5rem !important;
      right: 1.5rem !important;
      z-index: 999999999 !important;
      width: auto !important;
      height: auto !important;
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
      background: none !important;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
    ">
      <!-- Toggle Button -->
      <button id="toggleButton" style="
        position: fixed !important;
        bottom: 1.5rem !important;
        right: 1.5rem !important;
        width: 4rem !important;
        height: 4rem !important;
        border-radius: 50% !important;
        background: linear-gradient(135deg, rgb(13 148 136), rgb(15 118 110)) !important;
        border: none !important;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        cursor: pointer !important;
        margin: 0 !important;
        padding: 0 !important;
        outline: none !important;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
        font-size: 1rem !important;
        font-weight: normal !important;
        line-height: 1 !important;
        color: white !important;
        text-decoration: none !important;
        text-align: center !important;
        vertical-align: middle !important;
        white-space: nowrap !important;
        overflow: visible !important;
        box-sizing: border-box !important;
        transform: none !important;
        transition: transform 0.2s ease !important;
        animation: none !important;
        opacity: 1 !important;
        visibility: visible !important;
        z-index: 999999999 !important;
      ">
        <svg width="28" height="28" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="
          width: 1.75rem !important;
          height: 1.75rem !important;
          margin: 0 !important;
          padding: 0 !important;
          border: none !important;
          outline: none !important;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
          font-size: 1rem !important;
          font-weight: normal !important;
          line-height: 1 !important;
          color: white !important;
          text-decoration: none !important;
          text-align: center !important;
          vertical-align: middle !important;
          white-space: nowrap !important;
          overflow: visible !important;
          position: relative !important;
          z-index: 1 !important;
          min-width: 1.75rem !important;
          min-height: 1.75rem !important;
          max-width: 1.75rem !important;
          max-height: 1.75rem !important;
          box-sizing: border-box !important;
          box-shadow: none !important;
          transform: none !important;
          transition: none !important;
          animation: none !important;
          opacity: 1 !important;
          visibility: visible !important;
        ">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
        <div style="
          position: absolute !important;
          top: -4px !important;
          right: -4px !important;
          width: 12px !important;
          height: 12px !important;
          background: rgb(34 197 94) !important;
          border-radius: 50% !important;
          border: 2px solid white !important;
          margin: 0 !important;
          padding: 0 !important;
          outline: none !important;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
          font-size: 1rem !important;
          font-weight: normal !important;
          line-height: 1 !important;
          color: transparent !important;
          text-decoration: none !important;
          text-align: center !important;
          vertical-align: middle !important;
          white-space: nowrap !important;
          overflow: visible !important;
          box-sizing: border-box !important;
          box-shadow: none !important;
          transform: none !important;
          transition: none !important;
          animation: none !important;
          opacity: 1 !important;
          visibility: visible !important;
        "></div>
      </button>

      <!-- Chat Widget -->
      <div id="chatWidget" style="
        position: fixed !important;
        bottom: 6rem !important;
        right: 1.5rem !important;
        z-index: 999999998 !important;
        display: none !important;
        visibility: visible !important;
        width: 24rem !important;
        height: 32rem !important;
        background: white !important;
        border-radius: 1rem !important;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
        border: 1px solid rgb(229 231 235) !important;
        overflow: hidden !important;
        margin: 0 !important;
        padding: 0 !important;
        outline: none !important;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
        font-size: 1rem !important;
        font-weight: normal !important;
        line-height: 1.5 !important;
        color: rgb(17 24 39) !important;
        text-decoration: none !important;
        text-align: left !important;
        vertical-align: baseline !important;
        white-space: normal !important;
        opacity: 1 !important;
        transform: none !important;
        transition: none !important;
        animation: none !important;
        box-sizing: border-box !important;
      ">
        <!-- Header -->
        <div class="header" style="
          background: linear-gradient(135deg, rgb(153 246 228), rgb(94 234 212)) !important;
          border-bottom: 2px solid rgb(153 246 228) !important;
          padding: 1rem !important;
          display: flex !important;
          align-items: center !important;
          justify-content: space-between !important;
          margin: 0 !important;
          border: none !important;
          outline: none !important;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
          font-size: 1rem !important;
          font-weight: normal !important;
          line-height: 1.5 !important;
          color: rgb(19 78 74) !important;
          text-decoration: none !important;
          text-align: left !important;
          vertical-align: baseline !important;
          white-space: normal !important;
          overflow: visible !important;
          position: relative !important;
          z-index: 1 !important;
          width: 100% !important;
          height: auto !important;
          min-height: auto !important;
          max-height: none !important;
          box-sizing: border-box !important;
        ">
          <div class="header-left" style="
            display: flex !important;
            align-items: center !important;
            gap: 0.75rem !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            outline: none !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            font-size: 1rem !important;
            font-weight: normal !important;
            line-height: 1.5 !important;
            color: rgb(19 78 74) !important;
            text-decoration: none !important;
            text-align: left !important;
            vertical-align: baseline !important;
            white-space: normal !important;
            overflow: visible !important;
            position: relative !important;
            z-index: 1 !important;
            width: auto !important;
            height: auto !important;
            min-height: auto !important;
            max-height: none !important;
            box-sizing: border-box !important;
          ">
            <div class="avatar" style="
              width: 2.5rem !important;
              height: 2.5rem !important;
              background: linear-gradient(135deg, rgb(13 148 136), rgb(15 118 110)) !important;
              border-radius: 50% !important;
              display: flex !important;
              align-items: center !important;
              justify-content: center !important;
              margin: 0 !important;
              padding: 0 !important;
              border: none !important;
              outline: none !important;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
              font-size: 1rem !important;
              font-weight: normal !important;
              line-height: 1 !important;
              color: white !important;
              text-decoration: none !important;
              text-align: center !important;
              vertical-align: middle !important;
              white-space: nowrap !important;
              overflow: visible !important;
              position: relative !important;
              z-index: 1 !important;
              box-sizing: border-box !important;
            ">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="
                width: 1.25rem !important;
                height: 1.25rem !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                outline: none !important;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                font-size: 1rem !important;
                font-weight: normal !important;
                line-height: 1 !important;
                color: white !important;
                text-decoration: none !important;
                text-align: center !important;
                vertical-align: middle !important;
                white-space: nowrap !important;
                overflow: visible !important;
                position: relative !important;
                z-index: 1 !important;
                min-width: 1.25rem !important;
                min-height: 1.25rem !important;
                max-width: 1.25rem !important;
                max-height: 1.25rem !important;
                box-sizing: border-box !important;
                box-shadow: none !important;
                transform: none !important;
                transition: none !important;
                animation: none !important;
                opacity: 1 !important;
                visibility: visible !important;
              ">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
              </svg>
            </div>
            <div style="
              margin: 0 !important;
              padding: 0 !important;
              border: none !important;
              outline: none !important;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
              font-size: 1rem !important;
              font-weight: normal !important;
              line-height: 1.5 !important;
              color: rgb(19 78 74) !important;
              text-decoration: none !important;
              text-align: left !important;
              vertical-align: baseline !important;
              white-space: normal !important;
              overflow: visible !important;
              position: relative !important;
              z-index: 1 !important;
              width: auto !important;
              height: auto !important;
              min-height: auto !important;
              max-height: none !important;
              box-sizing: border-box !important;
            ">
              <div class="title" style="
                font-weight: 700 !important;
                color: rgb(19 78 74) !important;
                font-size: 1rem !important;
                line-height: 1.25rem !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                outline: none !important;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                text-decoration: none !important;
                text-align: left !important;
                vertical-align: baseline !important;
                white-space: normal !important;
                overflow: visible !important;
                position: relative !important;
                z-index: 1 !important;
                width: auto !important;
                height: auto !important;
                min-height: auto !important;
                max-height: none !important;
                box-sizing: border-box !important;
              ">My AI</div>
              <div class="status" style="
                font-size: 0.75rem !important;
                color: rgb(75 85 99) !important;
                display: flex !important;
                align-items: center !important;
                gap: 0.25rem !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                outline: none !important;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                font-weight: normal !important;
                line-height: 1 !important;
                text-decoration: none !important;
                text-align: left !important;
                vertical-align: baseline !important;
                white-space: normal !important;
                overflow: visible !important;
                position: relative !important;
                z-index: 1 !important;
                width: auto !important;
                height: auto !important;
                min-height: auto !important;
                max-height: none !important;
                box-sizing: border-box !important;
              ">
                <div class="status-dot" style="
                  width: 0.5rem !important;
                  height: 0.5rem !important;
                  background: rgb(34 197 94) !important;
                  border-radius: 50% !important;
                  margin: 0 !important;
                  padding: 0 !important;
                  border: none !important;
                  outline: none !important;
                  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                  font-size: 1rem !important;
                  font-weight: normal !important;
                  line-height: 1 !important;
                  color: transparent !important;
                  text-decoration: none !important;
                  text-align: center !important;
                  vertical-align: middle !important;
                  white-space: nowrap !important;
                  overflow: visible !important;
                  position: relative !important;
                  z-index: 1 !important;
                  box-sizing: border-box !important;
                  box-shadow: none !important;
                  transform: none !important;
                  transition: none !important;
                  animation: none !important;
                  opacity: 1 !important;
                  visibility: visible !important;
                "></div>
                Online 24/7
                <span class="language-badge" style="
                  background: rgb(229 231 235) !important;
                  color: rgb(75 85 99) !important;
                  padding: 0.125rem 0.375rem !important;
                  border-radius: 0.25rem !important;
                  font-size: 0.625rem !important;
                  font-weight: 500 !important;
                  margin-left: 0.5rem !important;
                ">EN</span>
              </div>
            </div>
          </div>
          <div class="header-right" style="
            display: flex !important;
            align-items: center !important;
            gap: 0.5rem !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            outline: none !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            font-size: 1rem !important;
            font-weight: normal !important;
            line-height: 1.5 !important;
            color: rgb(75 85 99) !important;
            text-decoration: none !important;
            text-align: left !important;
            vertical-align: baseline !important;
            white-space: normal !important;
            overflow: visible !important;
            position: relative !important;
            z-index: 1 !important;
            width: auto !important;
            height: auto !important;
            min-height: auto !important;
            max-height: none !important;
            box-sizing: border-box !important;
          ">
            <button id="minimizeButton" class="header-button" style="
              color: rgb(75 85 99) !important;
              background: none !important;
              border: none !important;
              padding: 0.5rem !important;
              border-radius: 0.5rem !important;
              cursor: pointer !important;
              transition: background-color 0.2s ease !important;
              margin: 0 !important;
              outline: none !important;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
              font-size: 1rem !important;
              font-weight: normal !important;
              line-height: 1 !important;
              text-decoration: none !important;
              text-align: center !important;
              vertical-align: middle !important;
              white-space: nowrap !important;
              overflow: visible !important;
              position: relative !important;
              z-index: 1 !important;
              width: auto !important;
              height: auto !important;
              min-height: auto !important;
              max-height: none !important;
              box-sizing: border-box !important;
            ">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="
                width: 1rem !important;
                height: 1rem !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                outline: none !important;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                font-size: 1rem !important;
                font-weight: normal !important;
                line-height: 1 !important;
                color: rgb(75 85 99) !important;
                text-decoration: none !important;
                text-align: center !important;
                vertical-align: middle !important;
                white-space: nowrap !important;
                overflow: visible !important;
                position: relative !important;
                z-index: 1 !important;
                min-width: 1rem !important;
                min-height: 1rem !important;
                max-width: 1rem !important;
                max-height: 1rem !important;
                box-sizing: border-box !important;
                box-shadow: none !important;
                transform: none !important;
                transition: none !important;
                animation: none !important;
                opacity: 1 !important;
                visibility: visible !important;
              ">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
              </svg>
            </button>
            <button id="closeButton" class="header-button" style="
              color: rgb(75 85 99) !important;
              background: none !important;
              border: none !important;
              padding: 0.5rem !important;
              border-radius: 0.5rem !important;
              cursor: pointer !important;
              transition: background-color 0.2s ease !important;
              margin: 0 !important;
              outline: none !important;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
              font-size: 1rem !important;
              font-weight: normal !important;
              line-height: 1 !important;
              text-decoration: none !important;
              text-align: center !important;
              vertical-align: middle !important;
              white-space: nowrap !important;
              overflow: visible !important;
              position: relative !important;
              z-index: 1 !important;
              width: auto !important;
              height: auto !important;
              min-height: auto !important;
              max-height: none !important;
              box-sizing: border-box !important;
            ">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="
                width: 1rem !important;
                height: 1rem !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                outline: none !important;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                font-size: 1rem !important;
                font-weight: normal !important;
                line-height: 1 !important;
                color: rgb(75 85 99) !important;
                text-decoration: none !important;
                text-align: center !important;
                vertical-align: middle !important;
                white-space: nowrap !important;
                overflow: visible !important;
                position: relative !important;
                z-index: 1 !important;
                min-width: 1rem !important;
                min-height: 1rem !important;
                max-width: 1rem !important;
                max-height: 1rem !important;
                box-sizing: border-box !important;
                box-shadow: none !important;
                transform: none !important;
                transition: none !important;
                animation: none !important;
                opacity: 1 !important;
                visibility: visible !important;
              ">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
            
        <!-- Messages -->
        <div id="messagesContainer" style="
          height: 24rem !important;
          overflow-y: auto !important;
          padding: 1rem !important;
          background: rgb(249 250 251) !important;
          margin: 0 !important;
          border: none !important;
          outline: none !important;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
          font-size: 1rem !important;
          font-weight: normal !important;
          line-height: 1.5 !important;
          color: rgb(17 24 39) !important;
          text-decoration: none !important;
          text-align: left !important;
          vertical-align: baseline !important;
          white-space: normal !important;
          position: relative !important;
          z-index: 1 !important;
          width: 100% !important;
          box-sizing: border-box !important;
        ">
          <div style="margin-bottom: 1rem; display: flex; justify-content: flex-start;">
            <div style="max-width: 80%; border-radius: 1rem; padding: 1rem; background: rgb(249 250 251); color: rgb(17 24 39); border: 1px solid rgb(229 231 235);">
              <div style="font-size: 0.875rem; line-height: 1.25rem;">Hello! I'm your ai</div>
              <div style="font-size: 0.75rem; margin-top: 0.25rem; color: rgb(107 114 128);">04:53</div>
            </div>
          </div>
        </div>
            
        <!-- Input -->
        <div class="input-area" style="
          padding: 1rem !important;
          background: white !important;
          border-top: 1px solid rgb(229 231 235) !important;
          display: flex !important;
          gap: 0.5rem !important;
          margin: 0 !important;
          border-left: none !important;
          border-right: none !important;
          border-bottom: none !important;
          outline: none !important;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
          font-size: 1rem !important;
          font-weight: normal !important;
          line-height: 1.5 !important;
          color: rgb(17 24 39) !important;
          text-decoration: none !important;
          text-align: left !important;
          vertical-align: baseline !important;
          white-space: normal !important;
          overflow: visible !important;
          position: relative !important;
          z-index: 1 !important;
          width: 100% !important;
          height: auto !important;
          min-height: auto !important;
          max-height: none !important;
          box-sizing: border-box !important;
        ">
          <input
            id="messageInput"
            type="text"
            placeholder="Type your id"
            style="
              flex: 1 !important;
              padding: 0.75rem 1rem !important;
              border: 1px solid rgb(209 213 219) !important;
              border-radius: 0.5rem !important;
              font-size: 0.875rem !important;
              line-height: 1.25rem !important;
              outline: none !important;
              background: white !important;
              margin: 0 !important;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
              font-weight: normal !important;
              color: rgb(17 24 39) !important;
              text-decoration: none !important;
              text-align: left !important;
              vertical-align: baseline !important;
              white-space: normal !important;
              overflow: visible !important;
              position: relative !important;
              z-index: 1 !important;
              width: auto !important;
              height: auto !important;
              min-height: auto !important;
              max-height: none !important;
              box-sizing: border-box !important;
            "
          />
          <button id="sendButton" style="
            background: rgb(13 148 136) !important;
            color: white !important;
            border: none !important;
            border-radius: 0.5rem !important;
            padding: 0.75rem 1rem !important;
            cursor: pointer !important;
            transition: opacity 0.2s ease !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            min-width: 3rem !important;
            height: 2.75rem !important;
            margin: 0 !important;
            outline: none !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            font-size: 1rem !important;
            font-weight: normal !important;
            line-height: 1 !important;
            text-decoration: none !important;
            text-align: center !important;
            vertical-align: middle !important;
            white-space: nowrap !important;
            overflow: visible !important;
            position: relative !important;
            z-index: 1 !important;
            box-sizing: border-box !important;
          ">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="
              width: 1.25rem !important;
              height: 1.25rem !important;
              margin: 0 !important;
              padding: 0 !important;
              border: none !important;
              outline: none !important;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
              font-size: 1rem !important;
              font-weight: normal !important;
              line-height: 1 !important;
              color: white !important;
              text-decoration: none !important;
              text-align: center !important;
              vertical-align: middle !important;
              white-space: nowrap !important;
              overflow: visible !important;
              position: relative !important;
              z-index: 1 !important;
              min-width: 1.25rem !important;
              min-height: 1.25rem !important;
              max-width: 1.25rem !important;
              max-height: 1.25rem !important;
              box-sizing: border-box !important;
              box-shadow: none !important;
              transform: none !important;
              transition: none !important;
              animation: none !important;
              opacity: 1 !important;
              visibility: visible !important;
            ">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const config = {
            chatbotId: urlParams.get('chatbotId') || 'default',
            apiKey: urlParams.get('apiKey') || 'demo-key',
            theme: urlParams.get('theme') || 'teal',
            title: urlParams.get('title') || 'My AI',
            welcomeMessage: urlParams.get('welcomeMessage') || 'Hello! I\'m your ai',
            placeholder: urlParams.get('placeholder') || 'Type your id',
            showAvatar: urlParams.get('showAvatar') !== 'false',
            primaryLanguage: urlParams.get('primaryLanguage') || 'en'
        };

        // Apply configuration
        const titleElement = document.querySelector('.title');
        if (titleElement) titleElement.textContent = config.title;
        
        const messageTextElement = document.querySelector('#messagesContainer div[style*="font-size: 0.875rem"]');
        if (messageTextElement) messageTextElement.textContent = config.welcomeMessage;
        
        const messageInputElement = document.getElementById('messageInput');
        if (messageInputElement) messageInputElement.placeholder = config.placeholder;
        
        const messageTimeElement = document.querySelector('#messagesContainer div[style*="font-size: 0.75rem"]');
        if (messageTimeElement) messageTimeElement.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        // Set language badge
        const languageCode = config.primaryLanguage.toUpperCase();
        const languageBadgeElement = document.querySelector('.language-badge');
        if (languageBadgeElement) languageBadgeElement.textContent = languageCode;

        // Widget state
        let isOpen = false;
        let conversationHistory = [];

        // Elements
        const toggleButton = document.getElementById('toggleButton');
        const chatWidget = document.getElementById('chatWidget');
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const closeButton = document.getElementById('closeButton');
        const minimizeButton = document.getElementById('minimizeButton');

        // Toggle widget
        function toggleWidget() {
            if (!isOpen) {
                chatWidget.style.display = 'block';
                toggleButton.style.display = 'none';
                isOpen = true;
                messageInput.focus();
            } else {
                chatWidget.style.display = 'none';
                toggleButton.style.display = 'flex';
                isOpen = false;
            }
        }

        // Close widget
        function closeWidget() {
            chatWidget.style.display = 'none';
            toggleButton.style.display = 'flex';
            isOpen = false;
        }

        // Send message
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            // Add user message
            addMessage(message, true);
            messageInput.value = '';

            // Show typing indicator
            showTypingIndicator();

            try {
                // Simulate API call
                const response = await fetch('https://aiorchestrator-vtihz.ondigitalocean.app/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${config.apiKey}`
                    },
                    body: JSON.stringify({
                        message: message,
                        chatbotId: config.chatbotId,
                        conversationHistory: conversationHistory,
                        context: {
                            primaryLanguage: config.primaryLanguage,
                            language: config.primaryLanguage
                        }
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    hideTypingIndicator();
                    addMessage(data.response || 'I understand your message. How can I help you further?', false);
                } else {
                    hideTypingIndicator();
                    addMessage('Sorry, I\'m having trouble responding right now. Please try again.', false);
                }
            } catch (error) {
                console.error('Chat error:', error);
                hideTypingIndicator();
                addMessage('Sorry, I\'m having trouble responding right now. Please try again.', false);
            }
        }

        // Add message to chat
        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                margin-bottom: 1rem;
                display: flex;
                justify-content: ${isUser ? 'flex-end' : 'flex-start'};
            `;
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div style="max-width: 80%; border-radius: 1rem; padding: 1rem; background: ${isUser ? 'rgb(13 148 136)' : 'rgb(249 250 251)'}; color: ${isUser ? 'white' : 'rgb(17 24 39)'}; border: ${isUser ? 'none' : '1px solid rgb(229 231 235)'};">
                    <div style="font-size: 0.875rem; line-height: 1.25rem;">${content}</div>
                    <div style="font-size: 0.75rem; margin-top: 0.25rem; color: ${isUser ? 'rgb(153 246 228)' : 'rgb(107 114 128)'};">${time}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Store in conversation history
            conversationHistory.push({
                role: isUser ? 'user' : 'assistant',
                content: content,
                timestamp: new Date()
            });
        }

        // Show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.style.cssText = `
                margin-bottom: 1rem;
                display: flex;
                justify-content: flex-start;
            `;
            typingDiv.innerHTML = `
                <div style="max-width: 80%; border-radius: 1rem; padding: 1rem; background: rgb(249 250 251); color: rgb(17 24 39); border: 1px solid rgb(229 231 235);">
                    <div style="display: flex; gap: 0.25rem;">
                        <div style="width: 0.5rem; height: 0.5rem; background: rgb(156 163 175); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both;"></div>
                        <div style="width: 0.5rem; height: 0.5rem; background: rgb(156 163 175); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; animation-delay: -0.16s;"></div>
                        <div style="width: 0.5rem; height: 0.5rem; background: rgb(156 163 175); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; animation-delay: -0.32s;"></div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            const typing = document.getElementById('typingIndicator');
            if (typing) {
                typing.remove();
            }
        }

        // Event listeners
        toggleButton.addEventListener('click', toggleWidget);
        closeButton.addEventListener('click', closeWidget);
        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendMessage();
            }
        });

        // Notify parent window that widget is ready
        if (window.parent !== window) {
            window.parent.postMessage({ type: 'widgetReady' }, '*');
        }
    </script>
</body>
</html>